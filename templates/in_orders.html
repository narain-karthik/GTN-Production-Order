{% extends "base.html" %}

{% block title %}IN Orders - Production Order Tracking System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1><i class="fas fa-arrow-down text-success me-3"></i>IN Orders</h1>
            <a href="{{ url_for('menu') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Menu
            </a>
        </div>
        
        <form id="ordersForm" method="POST" action="{{ url_for('save_orders') }}">
            <input type="hidden" name="order_type" value="IN">
            
            <div class="card">
                <div class="card-header">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="order_page" id="in_radio" checked disabled>
                        <label class="form-check-label" for="in_radio">
                            <strong>IN Orders Page</strong>
                        </label>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label for="workcenter" class="form-label">Work Center</label>
                            <select class="form-select" id="workcenter">
                                <option value="">Select Work Center</option>
                                {% for wc in workcenters %}
                                <option value="{{ wc.id }}">{{ wc.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="col-md-2">
                            <label for="production_order" class="form-label">Production Order</label>
                            <input type="text" class="form-control" id="production_order">
                        </div>
                        
                        <div class="col-md-1">
                            <label for="quantity" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="quantity" min="1">
                        </div>
                        
                        <div class="col-md-2">
                            <label for="remark" class="form-label">Remark</label>
                            <input type="text" class="form-control" id="remark" placeholder="Optional remark">
                        </div>
                        
                        <div class="col-md-3">
                            <label for="datetime" class="form-label">Date & Time</label>
                            <input type="text" class="form-control" id="datetime" readonly>
                        </div>
                        
                        <div class="col-md-1">
                            <label class="form-label">&nbsp;</label>
                            <button type="button" class="btn btn-success d-block" onclick="saveOrder()">
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Update datetime every second
function updateDateTime() {
    const now = new Date();
    const formatted = now.toLocaleString('en-GB', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    document.getElementById('datetime').value = formatted;
}

// Initialize and update datetime
updateDateTime();
setInterval(updateDateTime, 1000);

function saveOrder() {
    const workcenter = document.getElementById('workcenter');
    const productionOrder = document.getElementById('production_order');
    const quantity = document.getElementById('quantity');
    const remark = document.getElementById('remark');
    
    // Validation
    if (!workcenter.value) {
        alert('Please select a work center');
        return;
    }
    if (!productionOrder.value.trim()) {
        alert('Please enter a production order');
        return;
    }
    if (!quantity.value || quantity.value <= 0) {
        alert('Please enter a valid quantity');
        return;
    }
    
    // Create form and submit
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '{{ url_for("save_orders") }}';
    
    // Add form data (including remark)
    const orderData = `${workcenter.value}|${productionOrder.value.trim()}|${quantity.value}|${remark.value.trim()}`;
    
    form.innerHTML = `
        <input type="hidden" name="order_type" value="IN">
        <input type="hidden" name="orders" value="${orderData}">
    `;
    
    document.body.appendChild(form);
    form.submit();
}
</script>
{% endblock %}
