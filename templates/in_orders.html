{% extends "base.html" %}

{% block title %}IN Orders - Production Order Tracking System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1><i class="fas fa-arrow-down text-success me-3"></i>IN Orders</h1>
            <a href="{{ url_for('menu') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Menu
            </a>
        </div>
        
        <form id="ordersForm" method="POST" action="{{ url_for('save_orders') }}">
            <input type="hidden" name="order_type" value="IN">
            
            <div class="card">
                <div class="card-header">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="order_page" id="in_radio" checked disabled>
                        <label class="form-check-label" for="in_radio">
                            <strong>IN Orders Page</strong>
                        </label>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label for="workcenter" class="form-label">Work Center</label>
                            <select class="form-select" id="workcenter">
                                <option value="">Select Work Center</option>
                                {% for wc in workcenters %}
                                <option value="{{ wc.id }}">{{ wc.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="col-md-3">
                            <label for="production_order" class="form-label">Production Order</label>
                            <input type="text" class="form-control" id="production_order">
                        </div>
                        
                        <div class="col-md-2">
                            <label for="quantity" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="quantity" min="1">
                        </div>
                        
                        <div class="col-md-3">
                            <label for="datetime" class="form-label">Date & Time</label>
                            <input type="text" class="form-control" id="datetime" readonly>
                        </div>
                        
                        <div class="col-md-1">
                            <label class="form-label">&nbsp;</label>
                            <button type="button" class="btn btn-primary d-block" onclick="addOrder()">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header">
                    <h5><i class="fas fa-list me-2"></i>Orders to Save</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Work Center</th>
                                    <th>Production Order</th>
                                    <th>Quantity</th>
                                    <th>Date & Time</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTable">
                                <tr id="noOrdersRow">
                                    <td colspan="5" class="text-center text-muted">No orders added yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4">
                        <button type="submit" class="btn btn-success me-2" id="saveBtn">
                            <i class="fas fa-save me-2"></i>Save Orders
                        </button>
                        <a href="{{ url_for('menu') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back
                        </a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let orderCount = 0;

// Update datetime every second
function updateDateTime() {
    const now = new Date();
    const formatted = now.toLocaleString('en-GB', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    document.getElementById('datetime').value = formatted;
}

// Initialize and update datetime
updateDateTime();
setInterval(updateDateTime, 1000);

function addOrder() {
    const workcenter = document.getElementById('workcenter');
    const productionOrder = document.getElementById('production_order');
    const quantity = document.getElementById('quantity');
    const datetime = document.getElementById('datetime');
    
    
    const ordersTable = document.getElementById('ordersTable');
    const noOrdersRow = document.getElementById('noOrdersRow');
    
    if (noOrdersRow) {
        noOrdersRow.remove();
    }
    
    const workCenterText = workcenter.value ? workcenter.options[workcenter.selectedIndex].text : 'No Work Center';
    const workCenterValue = workcenter.value || '';
    const prodOrderValue = productionOrder.value || '';
    const quantityValue = quantity.value || '0';
    
    const row = document.createElement('tr');
    row.innerHTML = `
        <td>${workCenterText}</td>
        <td>${prodOrderValue}</td>
        <td>${quantityValue}</td>
        <td>${datetime.value}</td>
        <td>
            <button type="button" class="btn btn-sm btn-danger" onclick="removeOrder(this)">
                <i class="fas fa-trash"></i>
            </button>
        </td>
        <input type="hidden" name="orders" value="${workCenterValue}|${prodOrderValue}|${quantityValue}">
    `;
    
    ordersTable.appendChild(row);
    orderCount++;
    
    // Save button is always enabled
    
    // Clear form
    productionOrder.value = '';
    quantity.value = '';
    workcenter.selectedIndex = 0;
}

function removeOrder(button) {
    button.closest('tr').remove();
    orderCount--;
    
    if (orderCount === 0) {
        const ordersTable = document.getElementById('ordersTable');
        ordersTable.innerHTML = '<tr id="noOrdersRow"><td colspan="5" class="text-center text-muted">No orders added yet</td></tr>';
        // Save button remains enabled
    }
}
</script>
{% endblock %}
